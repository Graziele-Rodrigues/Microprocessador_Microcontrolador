RCC_APB2ENR EQU 0x40021018	

GPIOA_CRL	EQU 0x40010800
GPIOA_CRH	EQU 0x40010804
GPIOA_IDR	EQU 0x40010808
GPIOA_ODR	EQU 0x4001080C

GPIOB_CRL	EQU 0x40010C00
GPIOB_CRH	EQU 0x40010C04
GPIOB_IDR	EQU 0x40010C08
GPIOB_ODR	EQU 0x40010C0C

	EXPORT __main
	AREA MAIN, CODE, READONLY
__main
	LDR	R1,=RCC_APB2ENR
	LDR R0,[R1]
	ORR R0,R0,#0xFC		;enable the clocks for GPIOs
	STR R0,[R1]
	
	LDR R1,=GPIOB_CRL
	LDR R0,=0x33333333
	STR R0,[R1]			;PB0 to PB7 as outputs

	LDR R1,=GPIOB_CRH
	LDR R0,=0x33333333
	STR R0,[R1]			;PB8 to PB15 as outputs

	LDR R1,=GPIOA_CRL
	LDR R0,=0x88888888
	STR R0,[R1]			;PA0 to PA7 as inputs

	LDR R1,=GPIOA_CRH
	LDR R0,=0x88888888
	STR R0,[R1]			;PA8 to PA15 as inputs
	
	LDR R1,=GPIOA_ODR
	LDR R0,=0x0000
	STR R0,[R1]			;PA0 to PA15 pull-down
	
	
LOOP
	; LEITURA DOS SENSORES
	LDR	R10,=GPIOA_IDR
	LDR	R0,[R10]		;R0 = value of GPIOA_IDR
	
	;SENSORES
	; R1 = S1
	AND R1,R0,#0x01
	; R2 = S2
	LSR R0,R0,#0x01		;Logical Shift Right
	AND R2,R0,#0x01
	; R3 = S3
	LSR R0,R0,#0x01		;Logical Shift Right
	AND R3,R0,#0x01
	; R4 = S4
	LSR R0,R0,#0x01		;Logical Shift Right
	AND R4,R0,#0x01

	; Inicio do algoritmo de controle
	
	;Inicio B2
	AND R5, R1, R2
	CMP R5, #1
	BEQ DESLIGA
	MOV R11, #1
	MOV R9, R11
	B B2
DESLIGA
	MOV R11, #0
	MOV R9, R11

B2
	;INICIO B2
	MVN R6, R4
	MVN R7, R3
	AND R8, R6,R7
	AND R6, R8, R1
	CMP R6, #1
	BEQ LIGA
	MOV R12, #0
	B FIM
LIGA
	MOV R12, #1
FIM
	
	; Fim do algoritmo de controle

	; BOMBAS
	; R11 = BOMBA 1
	;MOV R11,R1	; Bomba 1 = S1
	; R12 = BOMBA 2
	;MOV R12,R2	; Bomba 2 = S2
	; CONCATENA RESPOSTA EM R12
	LSL R12,R12,#0x01
	ORR	R12,R12,R11
	
	; LIGA/DESLIGA BOMBAS
	LDR R10,=GPIOB_ODR
	STR R12,[R10]			;GPIOB_ODR = R12
	B LOOP
			
	END